<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Orçamento de Obra</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root {
      --bg:#f6f7fb; --card:#ffffff; --ink:#1b1f29; --muted:#646b7a;
      --pri:#2f6fed; --pri-ink:#fff; --bd:#e7e9ef; --soft:#f0f2f8;
      --ok:#1ea97c; --warn:#f59e0b; --err:#ef4444;
      --radius:14px;
    }
    html,body{margin:0;height:100%;}
    body{font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--ink);}
    .wrap{max-width:1200px;margin:24px auto;padding:0 16px;}
    header{display:flex;align-items:center;gap:16px;margin-bottom:16px;}
    #logoPreview{width:auto;max-height:56px;object-fit:contain;border-radius:8px;border:1px solid var(--bd);background:#fff;padding:6px;display:none;}
    .brand{flex:1;}
    .brand h1{font-family:Montserrat,Inter,sans-serif;font-size:28px;margin:0 0 6px 0;letter-spacing:.2px;}
    .brand .sub{color:var(--muted);font-size:14px;}
    .tools{display:flex;gap:8px;flex-wrap:wrap;}
    .btn{appearance:none;border:1px solid var(--bd);background:var(--card);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.pri{background:var(--pri);color:var(--pri-ink);border-color:transparent}
    .btn:hover{filter:brightness(.97)}
    .card{background:var(--card);border:1px solid var(--bd);border-radius:var(--radius);box-shadow:0 4px 16px rgba(10,20,60,.04);}
    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin:12px 0;}
    .tab{padding:10px 14px;border-radius:10px;border:1px solid var(--bd);background:var(--soft);cursor:pointer;font-weight:600}
    .tab.active{background:var(--pri);border-color:var(--pri);color:#fff}
    .grid{display:grid;grid-template-columns:1.2fr 2fr;gap:16px}
    .stage{padding:16px}
    .stage h2{font-family:Montserrat,Inter,sans-serif;font-size:20px;margin:0 0 8px 0}
    .stage .meta{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:13px}
    .stage .meta label{display:flex;gap:6px;align-items:center}
    .box{padding:16px}
    .rows{width:100%;border-collapse:collapse;font-size:14px}
    .rows thead th{position:sticky;top:0;background:var(--soft);z-index:1}
    .rows th,.rows td{border-bottom:1px solid var(--bd);padding:10px;vertical-align:middle}
    .rows td.sel{width:50px;text-align:center}
    .rows td.qty{width:120px}
    .rows td.qty input{width:100%;padding:8px;border:1px solid var(--bd);border-radius:8px;background:#fff}
    .rows td select,.rows td input[type="number"]{width:100%;padding:8px;border:1px solid var(--bd);border-radius:8px;background:#fff}
    .rows tfoot td{font-weight:800}
    .stageFooter{display:flex;justify-content:space-between;align-items:center;padding:12px 10px;border-top:1px solid var(--bd);background:var(--soft);border-radius:0 0 var(--radius) var(--radius)}
    .money{font-variant-numeric:tabular-nums}
    .aside{padding:16px}
    .aside h3{margin:0 0 10px 0}
    .aside .sum{background:var(--soft);border:1px solid var(--bd);border-radius:12px;padding:12px;font-weight:700;display:flex;justify-content:space-between}
    .aside .line{display:flex;justify-content:space-between;margin:6px 0;color:var(--muted)}
    .muted{color:var(--muted)}
    .footerTools{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .hint{font-size:12px;color:var(--muted)}
    .stickybar{position:sticky;top:16px}
    .switch{display:inline-flex;align-items:center;gap:8px}
    .switch input{transform:scale(1.2)}
    .search{display:flex;gap:8px;margin:8px 0}
    .search input{flex:1;padding:10px;border:1px solid var(--bd);border-radius:12px}
    .search .btn{padding:10px 12px}
    .stageOff{opacity:.5}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}.stickybar{position:static}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img id="logoPreview" alt="Logo" />
      <div class="brand">
        <h1>Calculadora de Orçamento</h1>
        <div class="sub">Do alicerce ao telhado · Materiais + composições automáticas</div>
      </div>
      <div class="tools">
        <label class="btn">
          Importar Logotipo
          <input id="logoInput" type="file" accept="image/png,image/jpeg" style="display:none" />
        </label>
        <button class="btn pri" id="btnExportPDF">Exportar PDF</button>
        <button class="btn" id="btnExportExcel">Exportar Excel</button>
        <button class="btn" id="btnPrint">Imprimir</button>
      </div>
    </header>

    <div class="card box">
      <div class="tabs" id="tabs"></div>
      <div class="grid">
        <div class="card stage" id="stage"></div>
        <aside class="card aside stickybar">
          <h3>Resumo</h3>
          <div id="summaryLines"></div>
          <div class="sum"><span>Total Geral</span><span id="grandTotal" class="money">R$ 0,00</span></div>
          <div class="footerTools">
            <button class="btn" id="btnReset">Limpar</button>
            <button class="btn pri" id="btnFinalize">Adicionar ao Resumo</button>
          </div>
          <div class="hint">Selecione os itens de cada etapa. Ajuste área (m²) ou metro linear (ml) no topo da etapa.</div>
        </aside>
      </div>
    </div>
  </div>

  <script src="materiais.js"></script>
  <script src="composicoes.js"></script>
  <script src="scripts.js"></script>
</body>
</html>
